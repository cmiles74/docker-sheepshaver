SheepShaver Docker Image
==================================

You can pull this image from Docker Hub.

    docker pull cmiles74/docker-sheepshaver
    
Last week I was cleaning out my office and I found an old clamshell iBook from
way back in 1999. It powers up but the CD-ROM drive is dead and although it has
a USB port, it doesn't want to boot from it. I put it on the shelf in case I
come across a replacement CD-ROM drive, but after that I kept thinking about
those days on that laptop with Mac OS 9, working as a web developer doing mostly
HTML, PHP and a little bit of JavaScript. And then I found [SheepShaver][0]!

This image provides a Debian Wheezy image with a working instance of the
SheepShaver PowerPC emulator, all ready to run your favorite Classic MacOS
version (9.0.2 back to the late 7 series.) It's not perfect but it seemed to
play Marathon okay. `;-)`

Running the Image
--------------------

This image comes with a handy "run" script that will probably do everything that
you need. It allows X11 access to the docker user, provides access to your audio
interfaces and runs Docker in ["privileged mode"][1]. We need privilege mode so
that it can get access to your network adapter (more on that later).

Take a look at this script, you'll need to customize the variables at the top so
that it does what you want. I'm not going to go through a complete setup here
(you can find more information on [Emaculation.com][2]), but here are some
important details...

### Mac OS ROM File

SheepShaver needs a copy of a Macintosh ROM file. In my experience, it won't
work with any ROM file that was created after then end of 1999 (anything from
2000 onwards won't work.) You can find some of
these [ROM files on the internet][3].

### Macintosh Hard Drive File

Sheepshaver can create a hard drive file for you through it's GUI interface. The
default configuration in the "run" file disables this interface (that's easiest
with day-to-day use), but you will want to enable it while you fiddle with the
various settings. Change the flag in the "run" file and you can create the disk
and get things working.

### Installation Media

Lastly, you'll need an ISO (or ".toast") file with the installation media. You
can mount that in SheepShaver and your emulated Macintosh will boot from it. You
can find [Mac OS 9 images on the internet][4] that will work, but make sure the
image file *is not writeable!* If the file is writeable, the emulated Macintosh
will complain that it's a copy and refuse to boot.

Network Access
----------------

SheepShaver requires a custom kernel module that creates a new network device in
order to allow network access for the emulated Macintosh. Since I have no idea
what kernel version you are running I can't create this module for you ahead of
time. Lucky for you, it's pretty easy to create the module yourself. Firstly,
you'll need to check out the source code for SheepShaver.

    git clone https://github.com/cebix/macemu
    
Instructions for compiling and installing it [are available as well][5]. I
followed those instructions step-by-step and it worked well.

SheepShaver has several options for connecting to your network devices. I myself
have only had success with the "slirp" interface, but your mileage may vary.

Why Don't I Just Compile the Whole Project?
-------------------------------------------------

You might be wondering, since you have all of the source code checked out
anyway, why don't you just compile the whole thing? Well, SheepShaver requires
the GCC compiler, version 4.6 and if you check your workstation out, you'll see
it's running 6.x.x or newer.

    gcc --version
    
Under anything newer that 4.6, the project will fail to compile. You could
install that old version of GCC, but you'll run into other problems (ABI
changes, etc.) The best plan is to run the application in the environment it
expects (something old like Debian Wheezy). The kernel module will compile with
a recent GCC and lo and hehold, everything works pretty well.


[0]: https://sheepshaver.cebix.net/
[1]: https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities
[2]: http://www.emaculation.com/doku.php/ubuntu
[3]: https://www.macintoshrepository.org/7038-all-macintosh-roms-68k-ppc
[4]: https://www.macintoshrepository.org/2417-mac-os-9-0-4-us
[5]: https://github.com/cebix/macemu/tree/master/BasiliskII/src/Unix/Linux/NetDriver

